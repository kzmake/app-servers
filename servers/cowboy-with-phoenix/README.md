# Elixir: cowboy + phoenix

Created from `mix phx.new cowboy-with-phoenix --app hello_world --no-ecto --no-brunch`

## Bootstrap

```sh
$ MIX_ENV=prod mix do deps.get, compile, phx.digest
$ PORT=4000 MIX_ENV=prod elixir --detached -S mix phx.server
```


# Elixir: cowboy + plug

## Result

### wrk

```sh
# wrk -t 4 -c 100 -d30s --timeout 2000 http://192.168.10.10:4000/
Running 30s test @ http://192.168.10.10:4000/
  4 threads and 100 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     5.32ms    2.72ms  65.90ms   98.91%
    Req/Sec     4.89k   376.06     6.93k    95.34%
  584872 requests in 30.10s, 109.43MB read
Requests/sec:  19430.99
Transfer/sec:      3.64MB
```

### dstat

```bash
# dstat -tf -cm -C 0,1,2,3,total --noheaders --output cowboy-with-plug.csv 1
----system---- -----cpu0-usage----------cpu1-usage----------cpu2-usage----------cpu3-usage-------total-cpu-usage-- ------memory-usage-----
     time     |usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl:usr sys idl wai stl| used  free  buff  cach
11-11 18:24:02|  6   1  93   0   0:  6   1  93   0   0:  6   1  93   0   0:  6   1  93   0   0:  6   1  93   0   0| 181M 3325M 96.3M  277M
11-11 18:24:03|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 181M 3325M 96.3M  277M
11-11 18:24:04|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 181M 3325M 96.3M  277M
11-11 18:24:05|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 181M 3325M 96.3M  277M
11-11 18:24:06|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 181M 3325M 96.3M  277M
11-11 18:24:07| 82  17   1   0   0: 76  22   2   0   0: 76  22   2   0   0: 69  29   2   0   0: 75  23   2   0   0| 181M 3324M 96.3M  277M
11-11 18:24:08| 85  11   4   0   0: 80  15   5   0   0: 73  23   4   0   0: 71  25   4   0   0: 77  19   4   0   0| 181M 3324M 96.4M  277M
11-11 18:24:09| 89  11   0   0   0: 83  17   0   0   0: 80  20   0   0   0: 80  20   0   0   0: 83  17   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:10| 86  14   0   0   0: 84  16   0   0   0: 83  17   0   0   0: 78  22   0   0   0: 83  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:11| 85  15   0   0   0: 84  16   0   0   0: 82  18   0   0   0: 74  26   0   0   0: 81  19   0   0   0| 180M 3325M 96.4M  277M
11-11 18:24:12| 82  18   0   0   0: 85  15   0   0   0: 80  20   0   0   0: 83  17   0   0   0: 82  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:13| 76  24   0   0   0: 78  22   0   0   0: 78  22   0   0   0: 82  18   0   0   0: 79  21   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:14| 84  16   0   0   0: 86  14   0   0   0: 78  22   0   0   0: 84  16   0   0   0: 83  17   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:15| 79  21   0   0   0: 78  22   0   0   0: 84  16   0   0   0: 83  17   0   0   0: 81  19   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:16| 80  20   0   0   0: 83  17   0   0   0: 79  21   0   0   0: 82  18   0   0   0: 81  19   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:17| 83  17   0   0   0: 86  14   0   0   0: 81  19   0   0   0: 81  19   0   0   0: 82  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:18| 81  19   0   0   0: 83  17   0   0   0: 85  15   0   0   0: 81  19   0   0   0: 83  17   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:19| 87  13   0   0   0: 83  17   0   0   0: 81  19   0   0   0: 75  25   0   0   0: 82  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:20| 82  18   0   0   0: 83  17   0   0   0: 82  18   0   0   0: 80  20   0   0   0: 82  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:21| 86  14   0   0   0: 82  18   0   0   0: 85  15   0   0   0: 82  18   0   0   0: 84  16   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:22| 79  17   4   0   0: 81  14   5   0   0: 77  19   4   0   0: 71  25   4   0   0: 77  19   4   0   0| 181M 3324M 96.4M  277M
11-11 18:24:23| 83  17   0   0   0: 83  17   0   0   0: 81  19   0   0   0: 74  26   0   0   0: 80  20   0   0   0| 181M 3323M 96.4M  277M
11-11 18:24:24| 84  16   0   0   0: 78  22   0   0   0: 77  23   0   0   0: 75  25   0   0   0: 79  22   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:25| 83  17   0   0   0: 82  18   0   0   0: 81  19   0   0   0: 75  25   0   0   0: 80  20   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:26| 88  12   0   0   0: 82  18   0   0   0: 87  13   0   0   0: 76  24   0   0   0: 83  17   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:27| 81  19   0   0   0: 83  17   0   0   0: 82  18   0   0   0: 80  20   0   0   0: 82  19   0   0   0| 182M 3323M 96.4M  277M
11-11 18:24:28| 80  20   0   0   0: 82  18   0   0   0: 85  15   0   0   0: 83  17   0   0   0: 82  18   0   0   0| 181M 3324M 96.4M  277M
11-11 18:24:29| 80  20   0   0   0: 86  14   0   0   0: 80  20   0   0   0: 83  17   0   0   0: 83  17   0   0   0| 180M 3325M 96.4M  277M
11-11 18:24:30| 79  21   0   0   0: 80  20   0   0   0: 85  15   0   0   0: 85  15   0   0   0: 82  18   0   0   0| 180M 3325M 96.4M  277M
11-11 18:24:31| 79  21   0   0   0: 88  12   0   0   0: 84  16   0   0   0: 81  19   0   0   0: 83  17   0   0   0| 179M 3326M 96.4M  277M
11-11 18:24:32| 84  12   4   0   0: 77  19   4   0   0: 86  10   4   0   0: 77  19   4   0   0: 81  15   4   0   0| 179M 3326M 96.4M  277M
11-11 18:24:33| 85  15   0   0   0: 83  17   0   0   0: 84  16   0   0   0: 78  22   0   0   0: 83  17   0   0   0| 180M 3325M 96.4M  277M
11-11 18:24:34| 82  18   0   0   0: 80  20   0   0   0: 88  12   0   0   0: 73  27   0   0   0: 81  19   0   0   0| 180M 3325M 96.4M  277M
11-11 18:24:35| 84  16   0   0   0: 81  19   0   0   0: 84  16   0   0   0: 78  22   0   0   0: 82  18   0   0   0| 179M 3326M 96.4M  277M
11-11 18:24:36| 86  14   0   0   0: 88  12   0   0   0: 84  16   0   0   0: 84  16   0   0   0: 85  15   0   0   0| 179M 3326M 96.4M  277M
11-11 18:24:37| 11   1  88   0   0: 10   2  88   0   0:  9   2  89   0   0:  9   3  88   0   0: 10   2  88   0   0| 179M 3326M 96.4M  277M
11-11 18:24:38|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 179M 3326M 96.4M  277M
11-11 18:24:39|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 179M 3326M 96.4M  277M
11-11 18:24:40|  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0:  0   0 100   0   0| 179M 3326M 96.4M  277M
```